# NextShop â€” Next.js å…¨æ ˆç”µå•†å¹³å°

> ä¸€ä¸ªä¸“ä¸ºå‰ç«¯å¼€å‘è€…è®¾è®¡çš„ Node.js / Next.js å…¨æ ˆå­¦ä¹ é¡¹ç›®ã€‚
> åŒ…å« SSR æœåŠ¡ç«¯æ¸²æŸ“ã€RESTful APIã€æ•°æ®åº“æ“ä½œã€è®¤è¯é‰´æƒã€çŠ¶æ€ç®¡ç†ç­‰æ ¸å¿ƒåç«¯çŸ¥è¯†ã€‚

---

## ç›®å½•

- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [å¿«é€Ÿå¯åŠ¨](#å¿«é€Ÿå¯åŠ¨)
  - [æ–¹å¼ä¸€ï¼šDockerï¼ˆæ¨èï¼‰](#æ–¹å¼ä¸€dockeræ¨è)
  - [æ–¹å¼äºŒï¼šHomebrew å®‰è£… MySQL](#æ–¹å¼äºŒhomebrew-å®‰è£…-mysql)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [æ ¸å¿ƒæ¦‚å¿µè¯¦è§£](#æ ¸å¿ƒæ¦‚å¿µè¯¦è§£)
  - [1. Server Component vs Client Component](#1-server-component-vs-client-component)
  - [2. API Route Handlersï¼ˆåç«¯æ¥å£ï¼‰](#2-api-route-handlersåç«¯æ¥å£)
  - [3. Prisma ORMï¼ˆæ•°æ®åº“æ“ä½œï¼‰](#3-prisma-ormæ•°æ®åº“æ“ä½œ)
  - [4. NextAuth.jsï¼ˆè®¤è¯ç³»ç»Ÿï¼‰](#4-nextauthjsè®¤è¯ç³»ç»Ÿ)
  - [5. Middlewareï¼ˆä¸­é—´ä»¶ï¼‰](#5-middlewareä¸­é—´ä»¶)
  - [6. Zustandï¼ˆå®¢æˆ·ç«¯çŠ¶æ€ç®¡ç†ï¼‰](#6-zustandå®¢æˆ·ç«¯çŠ¶æ€ç®¡ç†)
  - [7. Zodï¼ˆæ•°æ®éªŒè¯ï¼‰](#7-zodæ•°æ®éªŒè¯)
- [é¡µé¢è·¯ç”±ä¸€è§ˆ](#é¡µé¢è·¯ç”±ä¸€è§ˆ)
- [API æ¥å£ä¸€è§ˆ](#api-æ¥å£ä¸€è§ˆ)
- [æ•°æ®æ¨¡å‹å…³ç³»å›¾](#æ•°æ®æ¨¡å‹å…³ç³»å›¾)
- [æ•´ä½“æ¶æ„å›¾](#æ•´ä½“æ¶æ„å›¾)
- [å¸¸ç”¨å‘½ä»¤](#å¸¸ç”¨å‘½ä»¤)
- [å­¦ä¹ è·¯çº¿å»ºè®®](#å­¦ä¹ è·¯çº¿å»ºè®®)

---

## æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç”¨é€” | ä¸ºä»€ä¹ˆé€‰å®ƒï¼Ÿ |
|------|------|-------------|
| **Next.js 16** | å…¨æ ˆæ¡†æ¶ | App Router æ”¯æŒ SSR/SSG/API ä¸€ä½“åŒ– |
| **TypeScript** | ç±»å‹å®‰å…¨ | å‰ç«¯å·¥ç¨‹å¸ˆæœ€ç†Ÿæ‚‰çš„å¼ºç±»å‹è¯­è¨€ |
| **Prisma v7** | æ•°æ®åº“ ORM | ç±»å‹å®‰å…¨ã€è‡ªåŠ¨è¡¥å…¨ï¼Œæ¯”æ‰‹å†™ SQL æ›´å‹å¥½ |
| **MySQL 8.0** | å…³ç³»å‹æ•°æ®åº“ | ä¸šç•Œæœ€æµè¡Œçš„å¼€æºæ•°æ®åº“ |
| **NextAuth.js v5** | è®¤è¯é‰´æƒ | å¼€ç®±å³ç”¨ï¼Œæ”¯æŒ JWT + OAuth |
| **Tailwind CSS v4** | æ ·å¼ | åŸå­åŒ– CSSï¼Œå‰ç«¯å·¥ç¨‹å¸ˆéƒ½æ‡‚ |
| **Zustand** | å®¢æˆ·ç«¯çŠ¶æ€ | æ¯” Redux ç®€å• 10 å€çš„çŠ¶æ€ç®¡ç† |
| **Zod v4** | æ•°æ®éªŒè¯ | å‰åç«¯å…±ç”¨åŒä¸€å¥—éªŒè¯è§„åˆ™ |
| **Docker** | å®¹å™¨åŒ– | ä¸€é”®å¯åŠ¨ MySQLï¼Œæ— éœ€æœ¬åœ°å®‰è£… |

---

## å¿«é€Ÿå¯åŠ¨

### å‰ç½®è¦æ±‚

- Node.js 22+ï¼ˆæ¨èä½¿ç”¨ nvm ç®¡ç†ç‰ˆæœ¬ï¼‰
- Docker Desktop **æˆ–è€…** Homebrewï¼ˆäºŒé€‰ä¸€ï¼Œç”¨äºè¿è¡Œ MySQLï¼‰

---

### æ–¹å¼ä¸€ï¼šDockerï¼ˆæ¨èï¼‰

> Docker æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œä¸éœ€è¦åœ¨æœ¬åœ°å®‰è£…å’Œé…ç½® MySQLã€‚

**ç¬¬ 1 æ­¥ï¼šå®‰è£… Docker Desktop**

```bash
# ç”¨ Homebrew å®‰è£… Docker Desktop
brew install --cask docker

# å®‰è£…åæ‰“å¼€ Docker Desktop åº”ç”¨ï¼Œç­‰å¾… Docker Engine å¯åŠ¨å®Œæˆ
# èœå•æ å‡ºç° ğŸ³ å›¾æ ‡è¡¨ç¤ºå¯åŠ¨æˆåŠŸ
```

**ç¬¬ 2 æ­¥ï¼šå¯åŠ¨ MySQL æ•°æ®åº“**

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œï¼ˆä¼šè‡ªåŠ¨ä¸‹è½½ MySQL é•œåƒå¹¶å¯åŠ¨ï¼‰
docker compose up -d

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼ˆç¡®è®¤ mysql çŠ¶æ€ä¸º healthyï¼‰
docker compose ps

# æŸ¥çœ‹ MySQL æ—¥å¿—
docker compose logs -f mysql
```

**ç¬¬ 3 æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡**

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
cp .env.example .env
```

ä½¿ç”¨ Docker çš„é»˜è®¤é…ç½®ï¼Œ`.env` æ–‡ä»¶ä¸­çš„ `DATABASE_URL` åº”ä¸ºï¼š

```
DATABASE_URL="mysql://nextshop:nextshop123@localhost:3306/nextshop"
```

**ç¬¬ 4 æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“ & å¯åŠ¨é¡¹ç›®**

```bash
# 1. ç”Ÿæˆ Prisma Clientï¼ˆå°†æ•°æ®æ¨¡å‹ç¼–è¯‘ä¸º TypeScript ä»£ç ï¼‰
npx prisma generate

# 2. å°†æ•°æ®æ¨¡å‹åŒæ­¥åˆ° MySQL æ•°æ®åº“ï¼ˆåˆ›å»ºè¡¨ç»“æ„ï¼‰
npx prisma db push

# 3. å¡«å……ç§å­æ•°æ®ï¼ˆç®¡ç†å‘˜è´¦æˆ· + æµ‹è¯•å•†å“ï¼‰
npx prisma db seed

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:3000 ğŸ‰

---

### æ–¹å¼äºŒï¼šHomebrew å®‰è£… MySQL

> å¦‚æœä¸æƒ³ç”¨ Dockerï¼Œå¯ä»¥ç›´æ¥åœ¨ macOS ä¸Šå®‰è£… MySQLã€‚

**ç¬¬ 1 æ­¥ï¼šå®‰è£… MySQL**

```bash
# å®‰è£… MySQL 8.0
brew install mysql

# å¯åŠ¨ MySQL æœåŠ¡
brew services start mysql

# éªŒè¯æ˜¯å¦å¯åŠ¨æˆåŠŸ
mysql -u root -e "SELECT 1"
```

**ç¬¬ 2 æ­¥ï¼šåˆ›å»ºæ•°æ®åº“**

```bash
# ç™»å½• MySQL å‘½ä»¤è¡Œ
mysql -u root

# æ‰§è¡Œä»¥ä¸‹ SQL åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
```

```sql
-- åˆ›å»ºæ•°æ®åº“ï¼ˆä½¿ç”¨ utf8mb4 æ”¯æŒä¸­æ–‡å’Œ emojiï¼‰
CREATE DATABASE nextshop CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ç”¨ rootï¼‰
CREATE USER 'nextshop'@'localhost' IDENTIFIED BY 'nextshop123';

-- æˆæƒ
GRANT ALL PRIVILEGES ON nextshop.* TO 'nextshop'@'localhost';
FLUSH PRIVILEGES;

-- é€€å‡º
EXIT;
```

**ç¬¬ 3 æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡**

```bash
cp .env.example .env
```

ä¿®æ”¹ `.env` ä¸­çš„ `DATABASE_URL`ï¼š

```
# ä½¿ç”¨åˆšæ‰åˆ›å»ºçš„ç”¨æˆ·
DATABASE_URL="mysql://nextshop:nextshop123@localhost:3306/nextshop"

# æˆ–è€…ç›´æ¥ç”¨ rootï¼ˆHomebrew é»˜è®¤ root æ— å¯†ç ï¼‰
# DATABASE_URL="mysql://root@localhost:3306/nextshop"
```

**ç¬¬ 4 æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“ & å¯åŠ¨é¡¹ç›®**

```bash
npx prisma generate
npx prisma db push
npx prisma db seed
npm run dev
```

---

### æµ‹è¯•è´¦æˆ·

ç§å­æ•°æ®ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹æµ‹è¯•è´¦æˆ·ï¼š

| è§’è‰² | é‚®ç®± | å¯†ç  |
|------|------|------|
| ç®¡ç†å‘˜ | admin@nextshop.com | admin123 |
| æ™®é€šç”¨æˆ· | user@nextshop.com | user123 |

---

## é¡¹ç›®ç»“æ„

```
nextjs/
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma          # ğŸ“Œ æ•°æ®æ¨¡å‹å®šä¹‰ï¼ˆæœ€é‡è¦çš„æ–‡ä»¶ä¹‹ä¸€ï¼‰
â”‚   â””â”€â”€ seed.ts                # ç§å­æ•°æ®è„šæœ¬
â”œâ”€â”€ prisma.config.ts           # Prisma v7 é…ç½®æ–‡ä»¶
â”œâ”€â”€ docker-compose.yml         # Docker MySQL é…ç½®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                   # ğŸ“Œ Next.js App Routerï¼ˆé¡µé¢ & APIï¼‰
â”‚   â”‚   â”œâ”€â”€ layout.tsx         # æ ¹å¸ƒå±€ï¼ˆHTML ç»“æ„ã€å…¨å±€ Providerï¼‰
â”‚   â”‚   â”œâ”€â”€ globals.css        # å…¨å±€æ ·å¼
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ (auth)/            # ğŸ” è®¤è¯é¡µé¢ç»„
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx     #   è®¤è¯é¡µé¢ä¸“å±å¸ƒå±€ï¼ˆå±…ä¸­å¡ç‰‡æ ·å¼ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ login/page.tsx #   ç™»å½•é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ register/page.tsx  # æ³¨å†Œé¡µ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ (shop)/            # ğŸ›ï¸ å‰å°å•†åŸé¡µé¢ç»„
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx     #   å•†åŸå¸ƒå±€ï¼ˆHeader + Footerï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ loading.tsx    #   åŠ è½½çŠ¶æ€ UI
â”‚   â”‚   â”‚   â”œâ”€â”€ error.tsx      #   é”™è¯¯çŠ¶æ€ UI
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx       #   é¦–é¡µï¼ˆSSRï¼šç›´æ¥æŸ¥æ•°æ®åº“ï¼ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ products/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx           # å•†å“åˆ—è¡¨ï¼ˆæœç´¢ã€åˆ†ç±»ã€åˆ†é¡µï¼‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ page.tsx       # å•†å“è¯¦æƒ…ï¼ˆåŠ¨æ€è·¯ç”± + SEOï¼‰
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ AddToCartButton.tsx  # åŠ å…¥è´­ç‰©è½¦æŒ‰é’®
â”‚   â”‚   â”‚   â”œâ”€â”€ categories/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [slug]/page.tsx    # åˆ†ç±»å•†å“é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ cart/page.tsx          # è´­ç‰©è½¦é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ checkout/page.tsx      # ç»“ç®—é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ user/
â”‚   â”‚   â”‚       â”œâ”€â”€ layout.tsx         # ç”¨æˆ·ä¸­å¿ƒå¸ƒå±€
â”‚   â”‚   â”‚       â”œâ”€â”€ profile/page.tsx   # ä¸ªäººä¿¡æ¯ + åœ°å€ç®¡ç†
â”‚   â”‚   â”‚       â””â”€â”€ orders/page.tsx    # æˆ‘çš„è®¢å•
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ admin/             # ğŸ‘‘ åå°ç®¡ç†é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx     #   ç®¡ç†åå°å¸ƒå±€ï¼ˆä¾§è¾¹æ ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ loading.tsx    #   åŠ è½½çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ error.tsx      #   é”™è¯¯çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx       #   Dashboardï¼ˆç»Ÿè®¡é¢æ¿ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ products/      #   å•†å“ç®¡ç†ï¼ˆCRUDï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ orders/        #   è®¢å•ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ categories/    #   åˆ†ç±»ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ users/         #   ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ api/               # ğŸ”Œ åç«¯ API è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ auth/[...nextauth]/route.ts  # NextAuth è®¤è¯ç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ register/route.ts            # æ³¨å†Œæ¥å£
â”‚   â”‚       â”œâ”€â”€ cart/                        # è´­ç‰©è½¦ CRUD
â”‚   â”‚       â”œâ”€â”€ orders/                      # è®¢å•ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ payment/route.ts             # æ¨¡æ‹Ÿæ”¯ä»˜
â”‚   â”‚       â”œâ”€â”€ user/                        # ç”¨æˆ·ä¿¡æ¯ & åœ°å€
â”‚   â”‚       â””â”€â”€ admin/                       # ç®¡ç†å‘˜ä¸“ç”¨æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ components/            # ğŸ“¦ å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Providers.tsx      #   å…¨å±€ Providerï¼ˆSession ç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx     #   é¡¶éƒ¨å¯¼èˆªæ 
â”‚   â”‚   â”‚   â”œâ”€â”€ Footer.tsx     #   åº•éƒ¨ä¿¡æ¯æ 
â”‚   â”‚   â”‚   â””â”€â”€ AdminSidebar.tsx  # åå°ä¾§è¾¹æ 
â”‚   â”‚   â””â”€â”€ product/
â”‚   â”‚       â”œâ”€â”€ ProductCard.tsx    # å•†å“å¡ç‰‡
â”‚   â”‚       â””â”€â”€ ProductList.tsx    # å•†å“åˆ—è¡¨
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                   # ğŸ› ï¸ æ ¸å¿ƒåº“æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ prisma.ts          #   æ•°æ®åº“è¿æ¥ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ auth.ts            #   NextAuth å®Œæ•´é…ç½®
â”‚   â”‚   â”œâ”€â”€ auth.config.ts     #   NextAuth åŸºç¡€é…ç½®ï¼ˆEdge å…¼å®¹ï¼‰
â”‚   â”‚   â”œâ”€â”€ validators.ts      #   Zod éªŒè¯è§„åˆ™
â”‚   â”‚   â””â”€â”€ utils.ts           #   é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                 # ğŸ“Š å®¢æˆ·ç«¯çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ cart.ts            #   è´­ç‰©è½¦ Zustand Store
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                 # ğŸ·ï¸ TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts           #   è‡ªå®šä¹‰ç±»å‹ + NextAuth ç±»å‹æ‰©å±•
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware.ts          # ğŸš§ è·¯ç”±ä¸­é—´ä»¶ï¼ˆè®¤è¯æ‹¦æˆªï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ generated/prisma/     # ğŸ¤– Prisma è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ï¼ˆä¸è¦æ‰‹åŠ¨ä¿®æ”¹ï¼‰
â”‚
â”œâ”€â”€ .env.example               # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ package.json               # ä¾èµ–å’Œè„šæœ¬
â””â”€â”€ tsconfig.json              # TypeScript é…ç½®
```

### è·¯ç”±ç»„ `(auth)` `(shop)` æ˜¯ä»€ä¹ˆï¼Ÿ

Next.js App Router ä¸­ï¼Œç”¨åœ†æ‹¬å·åŒ…è£¹çš„æ–‡ä»¶å¤¹åå« **Route Group**ï¼ˆè·¯ç”±ç»„ï¼‰ã€‚
å®ƒ **ä¸ä¼š** å‡ºç°åœ¨ URL è·¯å¾„ä¸­ï¼Œåªç”¨äºç»„ç»‡ä»£ç å’Œå…±äº«å¸ƒå±€ã€‚

```
(auth)/login/page.tsx  â†’ URL: /login     ï¼ˆä¸æ˜¯ /auth/loginï¼‰
(shop)/page.tsx        â†’ URL: /          ï¼ˆä¸æ˜¯ /shopï¼‰
(shop)/products/page.tsx â†’ URL: /products
```

---

## æ ¸å¿ƒæ¦‚å¿µè¯¦è§£

### 1. Server Component vs Client Component

è¿™æ˜¯ä»å‰ç«¯è½¬å…¨æ ˆæœ€é‡è¦çš„æ¦‚å¿µï¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Next.js æ¸²æŸ“æ¨¡å‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Server Component       â”‚   Client Component              â”‚
â”‚   ï¼ˆé»˜è®¤ï¼Œåœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼‰    â”‚   ï¼ˆ'use client'ï¼Œåœ¨æµè§ˆå™¨æ‰§è¡Œï¼‰ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… ç›´æ¥æŸ¥æ•°æ®åº“            â”‚ âœ… useState / useEffect         â”‚
â”‚ âœ… è®¿é—®æœåŠ¡ç«¯èµ„æº           â”‚ âœ… äº‹ä»¶å¤„ç†ï¼ˆonClick ç­‰ï¼‰        â”‚
â”‚ âœ… è¯»å–ç¯å¢ƒå˜é‡            â”‚ âœ… æµè§ˆå™¨ APIï¼ˆlocalStorage ç­‰ï¼‰ â”‚
â”‚ âœ… async/await ç»„ä»¶        â”‚ âœ… ç¬¬ä¸‰æ–¹ UI åº“                  â”‚
â”‚ âŒ ä¸èƒ½ç”¨ useState        â”‚ âŒ ä¸èƒ½ç›´æ¥æŸ¥æ•°æ®åº“              â”‚
â”‚ âŒ ä¸èƒ½ç”¨ onClick          â”‚ âŒ ä¸èƒ½è¯»å–æœåŠ¡ç«¯ç¯å¢ƒå˜é‡         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é¡¹ç›®å®ä¾‹ï¼š**

```tsx
// src/app/(shop)/page.tsx â€” Server Componentï¼ˆæ²¡æœ‰ 'use client'ï¼‰
// è¿™æ®µä»£ç åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œæµè§ˆå™¨çœ‹ä¸åˆ°æ•°æ®åº“æŸ¥è¯¢ä»£ç ï¼
export default async function HomePage() {
  const products = await prisma.product.findMany({ take: 8 })
  //                ^^^^^ ç›´æ¥ await æŸ¥æ•°æ®åº“ï¼
  return <ProductList products={products} />
}

// src/app/(shop)/products/[id]/AddToCartButton.tsx â€” Client Component
'use client'  // å£°æ˜è¿™æ˜¯å®¢æˆ·ç«¯ç»„ä»¶
export default function AddToCartButton() {
  const [loading, setLoading] = useState(false)
  //                           ^^^^^^^^ éœ€è¦çŠ¶æ€ï¼Œæ‰€ä»¥ç”¨ Client Component
  const handleClick = async () => { /* è°ƒç”¨ API */ }
  return <button onClick={handleClick}>åŠ å…¥è´­ç‰©è½¦</button>
}
```

> ğŸ’¡ **è®°ä½è¿™ä¸ªåŸåˆ™ï¼š** èƒ½ç”¨ Server Component å°±ç”¨ Server Componentã€‚åªæœ‰éœ€è¦äº¤äº’ï¼ˆçŠ¶æ€ã€äº‹ä»¶ï¼‰æ—¶æ‰ç”¨ Client Componentã€‚

---

### 2. API Route Handlersï¼ˆåç«¯æ¥å£ï¼‰

åœ¨ Next.js ä¸­ï¼Œ`app/api/` ç›®å½•ä¸‹çš„ `route.ts` æ–‡ä»¶å°±æ˜¯åç«¯ API æ¥å£ã€‚

```
src/app/api/cart/route.ts     â†’ GET  /api/cartï¼ˆè·å–è´­ç‰©è½¦ï¼‰
                              â†’ POST /api/cartï¼ˆæ·»åŠ å•†å“ï¼‰
src/app/api/cart/[id]/route.ts â†’ PATCH  /api/cart/123ï¼ˆæ›´æ–°æ•°é‡ï¼‰
                              â†’ DELETE /api/cart/123ï¼ˆåˆ é™¤å•†å“ï¼‰
```

**ä»£ç ç¤ºä¾‹ï¼š**

```tsx
// src/app/api/cart/route.ts
import { NextResponse } from 'next/server'

// å¯¼å‡º GET å‡½æ•° = å¤„ç† GET /api/cart è¯·æ±‚
export async function GET(request: Request) {
  // 1. è·å–å½“å‰ç™»å½•ç”¨æˆ·
  const session = await auth()
  if (!session) {
    return NextResponse.json({ error: 'æœªç™»å½•' }, { status: 401 })
  }

  // 2. æŸ¥è¯¢æ•°æ®åº“
  const cartItems = await prisma.cartItem.findMany({
    where: { userId: session.user.id },
  })

  // 3. è¿”å› JSON å“åº”
  return NextResponse.json({ success: true, data: cartItems })
}

// å¯¼å‡º POST å‡½æ•° = å¤„ç† POST /api/cart è¯·æ±‚
export async function POST(request: Request) {
  const body = await request.json()  // è§£æè¯·æ±‚ä½“
  // ... éªŒè¯ã€å…¥åº“ã€è¿”å›ç»“æœ
}
```

> ğŸ’¡ **ç±»æ¯”å‰ç«¯ï¼š** Route Handler å°±åƒ Express çš„ `app.get('/api/cart', handler)`ï¼Œä½†ä¸éœ€è¦æ‰‹åŠ¨é…ç½®è·¯ç”±â€”â€”æ–‡ä»¶è·¯å¾„å°±æ˜¯è·¯ç”±ï¼

---

### 3. Prisma ORMï¼ˆæ•°æ®åº“æ“ä½œï¼‰

Prisma æ˜¯è¿æ¥æ•°æ®åº“çš„æ¡¥æ¢ã€‚ä½ åœ¨ `schema.prisma` ä¸­å®šä¹‰æ•°æ®æ¨¡å‹ï¼ŒPrisma è‡ªåŠ¨ç”Ÿæˆ TypeScript ä»£ç ã€‚

**æ ¸å¿ƒæ“ä½œé€ŸæŸ¥è¡¨ï¼š**

```typescript
import { prisma } from '@/lib/prisma'

// ---- æŸ¥è¯¢ ----
// æŸ¥æ‰¾æ‰€æœ‰å•†å“
const products = await prisma.product.findMany()

// æŒ‰æ¡ä»¶æŸ¥æ‰¾ï¼ˆWHEREï¼‰
const product = await prisma.product.findUnique({
  where: { id: 1 }
})

// æ¨¡ç³Šæœç´¢ + åˆ†é¡µ + æ’åº
const results = await prisma.product.findMany({
  where: {
    name: { contains: 'æ‰‹æœº' },         // LIKE '%æ‰‹æœº%'
    price: { gte: 100, lte: 5000 },     // 100 <= price <= 5000
  },
  include: { category: true },          // JOIN å…³è”æŸ¥è¯¢
  orderBy: { price: 'asc' },            // ORDER BY price ASC
  skip: 10,                             // OFFSET 10ï¼ˆè·³è¿‡å‰10æ¡ï¼‰
  take: 20,                             // LIMIT 20ï¼ˆå–20æ¡ï¼‰
})

// ---- åˆ›å»º ----
const user = await prisma.user.create({
  data: {
    name: 'å¼ ä¸‰',
    email: 'zhangsan@test.com',
    password: hashedPassword,
  }
})

// ---- æ›´æ–° ----
await prisma.product.update({
  where: { id: 1 },
  data: { stock: { decrement: 1 } }  // åº“å­˜ -1
})

// ---- åˆ é™¤ ----
await prisma.product.delete({
  where: { id: 1 }
})

// ---- èšåˆ ----
const count = await prisma.user.count()                    // SELECT COUNT(*)
const sales = await prisma.order.aggregate({
  _sum: { totalAmount: true }                              // SELECT SUM(totalAmount)
})

// ---- äº‹åŠ¡ ----
// äº‹åŠ¡ç¡®ä¿å¤šä¸ªæ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»š
await prisma.$transaction([
  prisma.cartItem.deleteMany({ where: { userId } }),       // æ¸…ç©ºè´­ç‰©è½¦
  prisma.order.create({ data: orderData }),                 // åˆ›å»ºè®¢å•
  prisma.product.update({ where: { id }, data: ... }),     // æ‰£å‡åº“å­˜
])
```

> ğŸ’¡ **å¯¹æ¯”å‰ç«¯ï¼š** å¦‚æœä½ ç”¨è¿‡ Sequelize æˆ– TypeORMï¼ŒPrisma çš„ API æ›´ç›´è§‰ã€‚å®ƒçš„è‡ªåŠ¨è¡¥å…¨éå¸¸å¼ºå¤§â€”â€”ä½ è¾“å…¥ `prisma.product.` å IDE ä¼šåˆ—å‡ºæ‰€æœ‰å¯ç”¨æ–¹æ³•å’Œå­—æ®µã€‚

---

### 4. NextAuth.jsï¼ˆè®¤è¯ç³»ç»Ÿï¼‰

æœ¬é¡¹ç›®ä½¿ç”¨ JWTï¼ˆJSON Web Tokenï¼‰æ–¹å¼è¿›è¡Œè®¤è¯ï¼Œè®¤è¯é…ç½®è¢«æ‹†åˆ†ä¸ºä¸¤ä¸ªæ–‡ä»¶ï¼š

```
è®¤è¯æ¶æ„ï¼š

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚            auth.config.ts               â”‚
  â”‚  ï¼ˆåŸºç¡€é…ç½®ï¼ŒEdge å…¼å®¹ï¼‰                   â”‚
  â”‚  â€¢ JWT å›è°ƒï¼ˆå°†ç”¨æˆ· ID/è§’è‰²ç¼–å…¥ Tokenï¼‰    â”‚
  â”‚  â€¢ Session å›è°ƒï¼ˆä» Token è¿˜åŸç”¨æˆ·ä¿¡æ¯ï¼‰   â”‚
  â”‚  â€¢ æˆæƒè§„åˆ™ï¼ˆå“ªäº›è·¯ç”±éœ€è¦ç™»å½•ï¼‰             â”‚
  â”‚  â€¢ é¡µé¢é…ç½®ï¼ˆè‡ªå®šä¹‰ç™»å½•é¡µè·¯å¾„ï¼‰             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            â”‚            â”‚
    â–¼            â–¼            â–¼
  middleware    auth.ts    API Routes
  (Edge Runtime) (Node.js)
  è·¯ç”±æ‹¦æˆª      å®Œæ•´è®¤è¯     æ¥å£é‰´æƒ
               (å« Prisma
                + bcrypt)
```

**ç™»å½•æµç¨‹ï¼š**

```
ç”¨æˆ·æäº¤é‚®ç®±+å¯†ç 
       â”‚
       â–¼
  POST /api/auth/callback/credentials
       â”‚
       â–¼
  authorize() å›è°ƒ
  â”œâ”€ prisma.user.findUnique({ email })  â† æŸ¥æ•°æ®åº“
  â”œâ”€ bcrypt.compare(æ˜æ–‡å¯†ç , å“ˆå¸Œå€¼)     â† æ¯”å¯¹å¯†ç 
  â””â”€ è¿”å› { id, name, email, role }
       â”‚
       â–¼
  jwt() å›è°ƒ â†’ å°† id, role å†™å…¥ JWT Token
       â”‚
       â–¼
  Token å­˜å…¥ HttpOnly Cookieï¼ˆæµè§ˆå™¨è‡ªåŠ¨æºå¸¦ï¼‰
       â”‚
       â–¼
  åç»­è¯·æ±‚ â†’ session() å›è°ƒ â†’ ä» Token è¯»å–ç”¨æˆ·ä¿¡æ¯
```

---

### 5. Middlewareï¼ˆä¸­é—´ä»¶ï¼‰

ä¸­é—´ä»¶æ˜¯"è¯·æ±‚é—¨å«"ï¼Œæ¯ä¸ªé¡µé¢è¯·æ±‚éƒ½ä¼šå…ˆç»è¿‡ä¸­é—´ä»¶æ£€æŸ¥ã€‚

```typescript
// src/middleware.ts
// æ‰€æœ‰åŒ¹é… matcher çš„è¯·æ±‚éƒ½ä¼šç»è¿‡è¿™é‡Œ

// æƒé™è§„åˆ™ï¼ˆåœ¨ auth.config.ts çš„ authorized å›è°ƒä¸­ï¼‰ï¼š
// 1. /user/*, /checkout â†’ éœ€è¦ç™»å½•ï¼Œå¦åˆ™è·³è½¬åˆ° /login
// 2. /admin/*           â†’ éœ€è¦ ADMIN è§’è‰²ï¼Œå¦åˆ™è·³è½¬åˆ° /
// 3. /login, /register  â†’ å·²ç™»å½•ç”¨æˆ·è·³è½¬åˆ° /
// 4. å…¶ä»–é¡µé¢            â†’ æ”¾è¡Œ
```

```
è¯·æ±‚æµç¨‹ï¼š

  æµè§ˆå™¨è¯·æ±‚ /admin/products
       â”‚
       â–¼
  middleware.tsï¼ˆEdge Runtimeï¼‰
  â””â”€ auth.config.ts çš„ authorized() å›è°ƒ
     â”œâ”€ æ£€æŸ¥ Cookie ä¸­çš„ JWT Token
     â”œâ”€ è§£æå‡ºç”¨æˆ·è§’è‰²
     â”œâ”€ role === 'ADMIN' ? âœ… æ”¾è¡Œ : âŒ é‡å®šå‘åˆ° /
       â”‚
       â–¼
  /admin/products/page.tsxï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰
```

---

### 6. Zustandï¼ˆå®¢æˆ·ç«¯çŠ¶æ€ç®¡ç†ï¼‰

è´­ç‰©è½¦ä½¿ç”¨ Zustand ç®¡ç†å®¢æˆ·ç«¯å®æ—¶çŠ¶æ€ï¼ŒåŒæ—¶é€šè¿‡ API åŒæ­¥åˆ°æ•°æ®åº“ã€‚

```
è´­ç‰©è½¦æ•°æ®æµï¼š

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     API è¯·æ±‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Zustand  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  æ•°æ®åº“   â”‚
  â”‚ (å®¢æˆ·ç«¯)  â”‚   POST /api/cart â”‚ (æœåŠ¡ç«¯)  â”‚
  â”‚           â”‚   GET /api/cart  â”‚           â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
  React ç»„ä»¶è‡ªåŠ¨æ›´æ–° UI
```

```typescript
// ä½¿ç”¨æ–¹å¼è¶…ç®€å•ï¼š
import { useCartStore } from '@/store/cart'

function CartIcon() {
  const totalItems = useCartStore((state) => state.totalItems)
  return <span>ğŸ›’ {totalItems()}</span>
}
```

---

### 7. Zodï¼ˆæ•°æ®éªŒè¯ï¼‰

Zod å®ç°å‰åç«¯å…±ç”¨åŒä¸€å¥—éªŒè¯è§„åˆ™ï¼š

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚         validators.tsï¼ˆå…±äº«éªŒè¯è§„åˆ™ï¼‰            â”‚
  â”‚  loginSchema / registerSchema / productSchema â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   å‰ç«¯é¡µé¢       â”‚  â”‚   API Route     â”‚
        â”‚  è¡¨å•å³æ—¶éªŒè¯    â”‚  â”‚  å…¥åº“å‰å†æ¬¡éªŒè¯   â”‚
        â”‚ ï¼ˆæå‡ç”¨æˆ·ä½“éªŒï¼‰ â”‚  â”‚ ï¼ˆç¡®ä¿æ•°æ®å®‰å…¨ï¼‰  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
// å‰åç«¯é€šç”¨
import { loginSchema } from '@/lib/validators'

const result = loginSchema.safeParse({ email, password })
if (!result.success) {
  // result.error.issues â†’ åŒ…å«æ‰€æœ‰éªŒè¯é”™è¯¯
} else {
  // result.data â†’ ç±»å‹å®‰å…¨çš„æ•°æ®
}
```

---

## é¡µé¢è·¯ç”±ä¸€è§ˆ

### å‰å°ï¼ˆå•†åŸï¼‰

| è·¯å¾„ | æ¸²æŸ“æ–¹å¼ | è¯´æ˜ |
|------|---------|------|
| `/` | SSRï¼ˆåŠ¨æ€ï¼‰ | é¦–é¡µï¼Œå±•ç¤ºæ¨èå•†å“å’Œåˆ†ç±» |
| `/products` | SSRï¼ˆåŠ¨æ€ï¼‰ | å•†å“åˆ—è¡¨ï¼Œæ”¯æŒæœç´¢/ç­›é€‰/åˆ†é¡µ |
| `/products/:id` | SSRï¼ˆåŠ¨æ€ï¼‰ | å•†å“è¯¦æƒ…ï¼ŒåŠ¨æ€ SEO |
| `/categories/:slug` | SSRï¼ˆåŠ¨æ€ï¼‰ | åˆ†ç±»å•†å“åˆ—è¡¨ |
| `/cart` | CSRï¼ˆå®¢æˆ·ç«¯ï¼‰ | è´­ç‰©è½¦ |
| `/checkout` | CSRï¼ˆå®¢æˆ·ç«¯ï¼‰ | ç»“ç®—ä¸‹å• |
| `/login` | é™æ€ | ç™»å½• |
| `/register` | é™æ€ | æ³¨å†Œ |
| `/user/profile` | CSRï¼ˆå®¢æˆ·ç«¯ï¼‰ | ä¸ªäººä¿¡æ¯ + åœ°å€ç®¡ç† |
| `/user/orders` | CSRï¼ˆå®¢æˆ·ç«¯ï¼‰ | æˆ‘çš„è®¢å• |

### åå°ï¼ˆç®¡ç†å‘˜ï¼‰

| è·¯å¾„ | æ¸²æŸ“æ–¹å¼ | è¯´æ˜ |
|------|---------|------|
| `/admin` | SSRï¼ˆåŠ¨æ€ï¼‰ | Dashboard æ•°æ®ç»Ÿè®¡ |
| `/admin/products` | SSRï¼ˆåŠ¨æ€ï¼‰ | å•†å“ç®¡ç†åˆ—è¡¨ |
| `/admin/products/new` | SSRï¼ˆåŠ¨æ€ï¼‰ | æ–°å¢å•†å“ |
| `/admin/products/:id/edit` | SSRï¼ˆåŠ¨æ€ï¼‰ | ç¼–è¾‘å•†å“ |
| `/admin/orders` | SSRï¼ˆåŠ¨æ€ï¼‰ | è®¢å•ç®¡ç† |
| `/admin/categories` | CSRï¼ˆå®¢æˆ·ç«¯ï¼‰ | åˆ†ç±»ç®¡ç† |
| `/admin/users` | SSRï¼ˆåŠ¨æ€ï¼‰ | ç”¨æˆ·ç®¡ç† |

> **æ¸²æŸ“æ–¹å¼è¯´æ˜ï¼š**
> - **SSRï¼ˆåŠ¨æ€ï¼‰**ï¼šæ¯æ¬¡è¯·æ±‚éƒ½åœ¨æœåŠ¡ç«¯æŸ¥è¯¢æ•°æ®åº“æ¸²æŸ“ â†’ æ•°æ®å®æ—¶
> - **CSRï¼ˆå®¢æˆ·ç«¯ï¼‰**ï¼šé¡µé¢åœ¨æµè§ˆå™¨ä¸­æ¸²æŸ“ï¼Œé€šè¿‡ API è·å–æ•°æ® â†’ æ”¯æŒäº¤äº’
> - **é™æ€**ï¼šæ„å»ºæ—¶ç”Ÿæˆï¼Œæ— éœ€æ•°æ®åº“ â†’ æœ€å¿«

---

## API æ¥å£ä¸€è§ˆ

### è®¤è¯

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/register` | ç”¨æˆ·æ³¨å†Œ |
| POST | `/api/auth/callback/credentials` | ç”¨æˆ·ç™»å½•ï¼ˆNextAuth è‡ªåŠ¨å¤„ç†ï¼‰ |
| GET | `/api/auth/session` | è·å–å½“å‰ä¼šè¯ï¼ˆNextAuth è‡ªåŠ¨å¤„ç†ï¼‰ |

### è´­ç‰©è½¦

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/cart` | è·å–è´­ç‰©è½¦åˆ—è¡¨ |
| POST | `/api/cart` | æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ |
| PATCH | `/api/cart/:id` | æ›´æ–°è´­ç‰©è½¦å•†å“æ•°é‡ |
| DELETE | `/api/cart/:id` | åˆ é™¤è´­ç‰©è½¦å•†å“ |

### è®¢å•

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/orders` | è·å–æˆ‘çš„è®¢å•åˆ—è¡¨ |
| POST | `/api/orders` | åˆ›å»ºè®¢å• |
| GET | `/api/orders/:id` | è·å–è®¢å•è¯¦æƒ… |
| POST | `/api/payment` | æ¨¡æ‹Ÿæ”¯ä»˜ |

### ç”¨æˆ·

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/user/profile` | è·å–ä¸ªäººä¿¡æ¯ |
| PATCH | `/api/user/profile` | æ›´æ–°ä¸ªäººä¿¡æ¯ |
| GET | `/api/user/addresses` | è·å–åœ°å€åˆ—è¡¨ |
| POST | `/api/user/addresses` | æ·»åŠ åœ°å€ |
| PATCH | `/api/user/addresses/:id` | æ›´æ–°åœ°å€ |
| DELETE | `/api/user/addresses/:id` | åˆ é™¤åœ°å€ |

### ç®¡ç†å‘˜

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/admin/products` | è·å–å•†å“åˆ—è¡¨ï¼ˆç®¡ç†å‘˜ï¼‰ |
| POST | `/api/admin/products` | åˆ›å»ºå•†å“ |
| GET | `/api/admin/products/:id` | è·å–å•†å“è¯¦æƒ… |
| PATCH | `/api/admin/products/:id` | æ›´æ–°å•†å“ |
| DELETE | `/api/admin/products/:id` | åˆ é™¤å•†å“ |
| GET | `/api/admin/categories` | è·å–åˆ†ç±»åˆ—è¡¨ |
| POST | `/api/admin/categories` | åˆ›å»ºåˆ†ç±» |
| PATCH | `/api/admin/categories/:id` | æ›´æ–°åˆ†ç±» |
| DELETE | `/api/admin/categories/:id` | åˆ é™¤åˆ†ç±» |
| GET | `/api/admin/orders/:id` | è·å–è®¢å•è¯¦æƒ… |
| PATCH | `/api/admin/orders/:id` | æ›´æ–°è®¢å•çŠ¶æ€ |
| GET | `/api/admin/users` | è·å–ç”¨æˆ·åˆ—è¡¨ |
| PATCH | `/api/admin/users` | æ›´æ–°ç”¨æˆ·è§’è‰² |

---

## æ•°æ®æ¨¡å‹å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User   â”‚â”€â”€1:Nâ”€â”€â”‚  CartItem   â”‚â”€â”€N:1â”€â”€â”‚ Product  â”‚
â”‚          â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚          â”‚
â”‚  id      â”‚                           â”‚ id       â”‚
â”‚  name    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ name     â”‚
â”‚  email   â”‚â”€â”€1:Nâ”€â”€â”‚   Order     â”‚      â”‚ price    â”‚
â”‚  passwordâ”‚      â”‚             â”‚      â”‚ stock    â”‚
â”‚  role    â”‚      â”‚ id          â”‚      â”‚ images   â”‚
â”‚          â”‚      â”‚ orderNo     â”‚      â”‚          â”‚
â”‚          â”‚      â”‚ totalAmount â”‚      â”‚          â”‚
â”‚          â”‚      â”‚ status      â”‚      â”‚ categoryIdâ”‚â”€â”€N:1â”€â”€â”
â”‚          â”‚      â”‚ address     â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚          â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
â”‚          â”‚             â”‚                           â”‚ Category â”‚
â”‚          â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                    â”‚          â”‚
â”‚          â”‚      â”‚  OrderItem  â”‚â”€â”€N:1â”€â”€Product      â”‚ id       â”‚
â”‚          â”‚      â”‚  quantity   â”‚                    â”‚ name     â”‚
â”‚          â”‚â”€â”€1:Nâ”€â”€â”‚  price      â”‚                    â”‚ slug     â”‚
â”‚          â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚          â”‚
â”‚          â”‚â”€â”€1:Nâ”€â”€â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          â”‚      â”‚   Address   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ name, phone â”‚
                  â”‚ province    â”‚
                  â”‚ city        â”‚
                  â”‚ detail      â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•´ä½“æ¶æ„å›¾

```
  æµè§ˆå™¨                    Next.js æœåŠ¡ç«¯                    æ•°æ®åº“
  â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ é¡µé¢è¯·æ±‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ /products â”‚             â”‚                                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â–¼                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
                    â”‚  Middleware   â”‚  æ£€æŸ¥ç™»å½•çŠ¶æ€              â”‚
                    â”‚  (Edge Runtime)â”‚                           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
                            â”‚                                   â”‚
                            â–¼                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Prisma     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”
                    â”‚    Server     â”‚â”€â”€â”€â”€â”€â”€ORMâ”€â”€â”€â”€â”€â”€â–ºâ”‚   MySQL    â”‚
                    â”‚   Component  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   æ•°æ®åº“    â”‚
                    â”‚  (æœåŠ¡ç«¯æ¸²æŸ“)  â”‚   æŸ¥è¯¢ç»“æœ      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTML
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æµè§ˆå™¨æ¸²æŸ“   â”‚
                    â”‚  Server HTML  â”‚
                    â”‚  + Client JS  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     fetch      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ç”¨æˆ·äº¤äº’  â”‚â”€â”€â”€â”€â”€â–ºâ”‚    Client     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  API Route â”‚
  â”‚ (ç‚¹å‡»ç­‰)  â”‚      â”‚   Component  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ /api/cart  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  (å®¢æˆ·ç«¯æ¸²æŸ“)  â”‚    JSON        â”‚            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚  Prisma    â”‚
                            â–²                        â”‚  â†• MySQL   â”‚
                            â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Zustand    â”‚
                    â”‚  çŠ¶æ€ç®¡ç†     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¸¸ç”¨å‘½ä»¤

```bash
# ==================== å¼€å‘ ====================
npm run dev                  # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆhttp://localhost:3000ï¼‰
npm run build                # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run start                # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨

# ==================== æ•°æ®åº“ ====================
npx prisma generate          # ç”Ÿæˆ Prisma Clientï¼ˆä¿®æ”¹ schema åæ‰§è¡Œï¼‰
npx prisma db push           # å°† schema åŒæ­¥åˆ°æ•°æ®åº“ï¼ˆå¼€å‘ç”¨ï¼Œä¸ç”Ÿæˆè¿ç§»æ–‡ä»¶ï¼‰
npx prisma migrate dev       # åˆ›å»ºè¿ç§»æ–‡ä»¶å¹¶åº”ç”¨ï¼ˆå›¢é˜Ÿåä½œæ—¶ä½¿ç”¨ï¼‰
npx prisma db seed           # è¿è¡Œç§å­æ•°æ®è„šæœ¬
npx prisma studio            # æ‰“å¼€ Prisma Studioï¼ˆæ•°æ®åº“å¯è§†åŒ–ç®¡ç†å·¥å…·ï¼‰
npx prisma migrate reset     # é‡ç½®æ•°æ®åº“ï¼ˆæ¸…ç©ºæ‰€æœ‰æ•°æ®å¹¶é‡æ–°æ‰§è¡Œè¿ç§»+ç§å­ï¼‰

# ==================== Docker ====================
docker compose up -d         # å¯åŠ¨ MySQL å®¹å™¨
docker compose down          # åœæ­¢ MySQL å®¹å™¨
docker compose logs -f mysql # æŸ¥çœ‹ MySQL æ—¥å¿—
docker compose exec mysql mysql -u root -proot123 nextshop  # è¿›å…¥ MySQL å‘½ä»¤è¡Œ
```

---

## å­¦ä¹ è·¯çº¿å»ºè®®

å»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºé˜…è¯»ä»£ç ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

### ç¬¬ä¸€é˜¶æ®µï¼šç†è§£åŸºç¡€

1. **`prisma/schema.prisma`** â€” æ•°æ®æ¨¡å‹å®šä¹‰ï¼Œç†è§£è¡¨ç»“æ„å’Œå…³ç³»
2. **`src/lib/prisma.ts`** â€” æ•°æ®åº“è¿æ¥ï¼Œç†è§£å•ä¾‹æ¨¡å¼å’Œ Prisma v7 é€‚é…å™¨
3. **`src/lib/utils.ts`** â€” é€šç”¨å·¥å…·å‡½æ•°
4. **`src/types/index.ts`** â€” TypeScript ç±»å‹å®šä¹‰ï¼Œç†è§£æ³›å‹å’Œç±»å‹æ‰©å±•

### ç¬¬äºŒé˜¶æ®µï¼šç†è§£è®¤è¯

5. **`src/lib/auth.config.ts`** â€” NextAuth åŸºç¡€é…ç½®ï¼ˆEdge å…¼å®¹ï¼‰
6. **`src/lib/auth.ts`** â€” NextAuth å®Œæ•´é…ç½®ï¼ˆå«å¯†ç éªŒè¯ï¼‰
7. **`src/middleware.ts`** â€” ä¸­é—´ä»¶è·¯ç”±ä¿æŠ¤
8. **`src/app/api/register/route.ts`** â€” æ³¨å†Œæ¥å£ï¼ˆç¬¬ä¸€ä¸ª API Routeï¼‰
9. **`src/app/(auth)/login/page.tsx`** â€” ç™»å½•é¡µï¼ˆClient Component + signInï¼‰
10. **`src/app/(auth)/register/page.tsx`** â€” æ³¨å†Œé¡µ

### ç¬¬ä¸‰é˜¶æ®µï¼šç†è§£ SSR å’Œæ•°æ®è·å–

11. **`src/app/(shop)/page.tsx`** â€” é¦–é¡µï¼ˆServer Component ç›´æ¥æŸ¥æ•°æ®åº“ï¼ï¼‰
12. **`src/app/(shop)/products/page.tsx`** â€” å•†å“åˆ—è¡¨ï¼ˆæœç´¢ã€åˆ†é¡µã€æ’åºï¼‰
13. **`src/app/(shop)/products/[id]/page.tsx`** â€” å•†å“è¯¦æƒ…ï¼ˆåŠ¨æ€è·¯ç”± + SEOï¼‰

### ç¬¬å››é˜¶æ®µï¼šç†è§£ API CRUD

14. **`src/lib/validators.ts`** â€” Zod éªŒè¯è§„åˆ™
15. **`src/app/api/cart/route.ts`** â€” è´­ç‰©è½¦ APIï¼ˆGET + POSTï¼‰
16. **`src/app/api/cart/[id]/route.ts`** â€” è´­ç‰©è½¦ APIï¼ˆPATCH + DELETEï¼‰
17. **`src/app/api/orders/route.ts`** â€” è®¢å• API

### ç¬¬äº”é˜¶æ®µï¼šç†è§£çŠ¶æ€ç®¡ç†

18. **`src/store/cart.ts`** â€” Zustand è´­ç‰©è½¦çŠ¶æ€ï¼ˆå®¢æˆ·ç«¯çŠ¶æ€ + API åŒæ­¥ï¼‰
19. **`src/app/(shop)/cart/page.tsx`** â€” è´­ç‰©è½¦é¡µé¢

### ç¬¬å…­é˜¶æ®µï¼šç†è§£ç®¡ç†åå°

20. **`src/app/admin/page.tsx`** â€” Dashboardï¼ˆPrisma èšåˆæŸ¥è¯¢ï¼‰
21. **`src/app/api/admin/products/route.ts`** â€” å•†å“ç®¡ç† API
22. **`src/app/admin/products/ProductForm.tsx`** â€” è¡¨å•ç»„ä»¶

### ç¬¬ä¸ƒé˜¶æ®µï¼šç†è§£éƒ¨ç½²å’Œä¼˜åŒ–

23. **`src/app/(shop)/loading.tsx`** â€” Loading UIï¼ˆSuspense è¾¹ç•Œï¼‰
24. **`src/app/(shop)/error.tsx`** â€” Error UIï¼ˆé”™è¯¯è¾¹ç•Œï¼‰
25. **`prisma/seed.ts`** â€” ç§å­æ•°æ®è„šæœ¬
26. **`docker-compose.yml`** â€” Docker å®¹å™¨åŒ–

---

> ğŸ¯ **å­¦ä¹ å»ºè®®ï¼š** æ¯è¯»å®Œä¸€ä¸ªæ–‡ä»¶ï¼Œå°è¯•è‡ªå·±ä¿®æ”¹ä»£ç å¹¶è§‚å¯Ÿæ•ˆæœã€‚æ¯”å¦‚ï¼š
> - ä¿®æ”¹ `schema.prisma` æ·»åŠ ä¸€ä¸ªæ–°å­—æ®µï¼Œç„¶å `prisma db push` çœ‹å˜åŒ–
> - åœ¨ API Route ä¸­æ·»åŠ  `console.log()`ï¼Œè§‚å¯Ÿç»ˆç«¯è¾“å‡º
> - ç”¨ `prisma studio` ç›´æ¥æŸ¥çœ‹æ•°æ®åº“æ•°æ®
> - æ•…æ„å†™é”™å¯†ç ç™»å½•ï¼Œè§‚å¯Ÿ NextAuth çš„é”™è¯¯å¤„ç†æµç¨‹
